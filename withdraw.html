<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Withdraw | Horizon Capital</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="shared-styles.css">
  <style>
    body {
      padding-top: 72px;
      background: #f5f7fa;
      min-height: 100vh;
    }
    .wrapper { 
      max-width: 720px; 
      margin: 0 auto; 
      padding: 20px 16px; 
    }
    .card { 
      background: #fff; 
      border-radius: 16px; 
      padding: 24px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.08); 
    }
    h1 { 
      margin: 0 0 16px 0; 
      font-size: 24px; 
      color: var(--text-dark); 
      font-weight: 700;
    }
    label { 
      display: block; 
      margin: 12px 0 6px; 
      font-weight: 600; 
      color: var(--text-dark);
      font-size: 0.9rem;
    }
    input, select, textarea { 
      width: 100%; 
      padding: 12px 14px; 
      border: 1px solid #cbd5e1; 
      border-radius: 10px; 
      font-size: 16px; 
      outline: none; 
      transition: all 0.3s ease;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    textarea { 
      resize: vertical; 
      min-height: 80px; 
    }
    .row { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 12px; 
    }
    .btn { 
      margin-top: 16px; 
      background: var(--primary-gradient); 
      color: #fff; 
      border: 0; 
      padding: 14px 16px; 
      border-radius: 10px; 
      cursor: pointer; 
      font-weight: 600; 
      width: 100%; 
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    .btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .tip { 
      color: var(--text-gray); 
      font-size: 13px; 
      margin-top: 6px; 
    }
    .panel { 
      margin-top: 12px; 
      padding: 16px; 
      border: 1px solid #e2e8f0; 
      border-radius: 10px; 
      background: #f8fafc; 
    }
    .panel h2 {
      margin: 0 0 12px 0; 
      font-size: 16px; 
      color: var(--text-dark); 
      font-weight: 600;
    }
    @media (max-width: 768px) {
      .wrapper {
        padding: 16px 12px;
      }
      .card {
        padding: 20px;
      }
      .row {
        grid-template-columns: 1fr;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-brand">HORIZON</a>
      <ul class="navbar-menu">
        <li><a href="index.html" class="navbar-link">Home</a></li>
        <li><a href="dashboard.html" class="navbar-link">Dashboard</a></li>
        <li><a href="real-estate.html" class="navbar-link">Real Estate</a></li>
        <li><a href="stocks.html" class="navbar-link">Stocks</a></li>
        <li><a href="bonds.html" class="navbar-link">Bonds</a></li>
        <li><a href="crypto.html" class="navbar-link">Crypto</a></li>
        <li><button onclick="logout()" class="navbar-btn btn-danger" style="padding: 0.5rem 1.25rem; font-size: 0.875rem;">Logout</button></li>
      </ul>
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i data-feather="menu"></i>
      </button>
    </div>
  </nav>

  <div class="wrapper">
    <div class="card">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
        <h1 style="margin: 0;">Request Withdrawal</h1>
        <a href="dashboard.html" style="display: flex; align-items: center; gap: 6px; color: var(--primary-color); text-decoration: none; font-weight: 600; font-size: 0.9rem;">
          <i data-feather="arrow-left" style="width: 16px; height: 16px;"></i>
          <span>Back to Dashboard</span>
        </a>
      </div>
      <form id="withdrawForm" novalidate onsubmit="handleWithdraw(event); return false;">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required />

        <div class="row">
          <div>
            <label for="amount">Amount</label>
            <input type="number" step="0.01" min="1" id="amount" name="amount" placeholder="1000" required />
          </div>
          <div>
            <label for="currency">Currency</label>
            <select id="currency" name="currency">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
            </select>
          </div>
        </div>

        <label for="method">Payout Method</label>
        <select id="method" name="method" required>
          <option value="">Select a method</option>
          <option value="bank_transfer">Bank Transfer</option>
          <option value="crypto">Crypto</option>
        </select>
        <div id="methodHelp" class="tip">Choose a payout method. For crypto, you must specify the correct network.</div>

        <!-- Crypto network (only visible when method = crypto) -->
        <div id="cryptoNetworkRow" class="row" style="display:none; margin-top:4px;">
          <div style="grid-column: 1 / -1;">
            <label for="cryptoNetwork">Crypto Network</label>
            <select id="cryptoNetwork" name="crypto_network">
              <option value="">Select network</option>
              <option value="TRC20">USDT (TRC20)</option>
              <option value="BTC">BTC (SegWit)</option>
              <option value="ERC20">ETH (ERC20)</option>
            </select>
            <div class="tip">Include the selected network (e.g., TRC20, BTC, ERC20) in the destination details.</div>
          </div>
        </div>

        <label for="destination">Destination Details</label>
        <textarea id="destination" name="destination" placeholder="Bank account or crypto wallet details" required></textarea>

        <!-- Instruction panels -->
        <div id="bankPanel" class="panel" style="display:none;">
          <h2 style="margin:0 0 8px 0; font-size:16px; color:#0a3d62;">Bank Transfer Payout</h2>
          <div class="tip">Provide your beneficiary bank details (account name/number, bank name, SWIFT/IBAN). Ensure details are accurate to avoid delays.</div>
        </div>
        <div id="cryptoPanel" class="panel" style="display:none;">
          <h2 style="margin:0 0 8px 0; font-size:16px; color:#0a3d62;">Crypto Payout</h2>
          <div class="tip">Provide the destination wallet address. Ensure the network matches the selection above (e.g., TRC20 for USDT, ERC20 for ETH, BTC SegWit address).</div>
        </div>

        <button class="btn" type="submit">Submit Withdrawal</button>
      </form>
    </div>
  </div>
  <script>
    (function(){
      const methodEl = document.getElementById('method');
      const helpEl = document.getElementById('methodHelp');
      const cryptoNetworkRow = document.getElementById('cryptoNetworkRow');
      const cryptoNetworkEl = document.getElementById('cryptoNetwork');
      const bankPanel = document.getElementById('bankPanel');
      const cryptoPanel = document.getElementById('cryptoPanel');
      const form = document.getElementById('withdrawForm');

      function updatePanels() {
        const val = methodEl.value;
        if (val === 'bank_transfer') {
          cryptoNetworkRow.style.display = 'none';
          bankPanel.style.display = '';
          cryptoPanel.style.display = 'none';
          helpEl.textContent = 'You selected Bank Transfer. Enter complete beneficiary bank details in Destination.';
        } else if (val === 'crypto') {
          cryptoNetworkRow.style.display = '';
          bankPanel.style.display = 'none';
          cryptoPanel.style.display = '';
          helpEl.textContent = 'You selected Crypto. Choose the network and ensure the destination matches it.';
        } else {
          cryptoNetworkRow.style.display = 'none';
          bankPanel.style.display = 'none';
          cryptoPanel.style.display = 'none';
          helpEl.textContent = 'Choose a payout method. For crypto, you must specify the correct network.';
        }
      }

      methodEl.addEventListener('change', updatePanels);
      updatePanels();

      // Validation: when crypto, require network and ensure destination mentions it
      form.addEventListener('submit', (e) => {
        if (methodEl.value === 'crypto') {
          const net = (cryptoNetworkEl.value || '').trim();
          if (!net) {
            e.preventDefault();
            alert('Please select a Crypto Network.');
            return;
          }
          const dest = (document.getElementById('destination').value || '').toUpperCase();
          if (!dest.includes(net)) {
            e.preventDefault();
            alert('Destination must include the selected network keyword: ' + net + '.');
            return;
          }
        }
      });
    })();

    function handleWithdraw(event) {
      event.preventDefault();
      const currentUser = localStorage.getItem('currentUser');
      if (!currentUser) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
      }
      
      const formData = new FormData(event.target);
      const amount = parseFloat(formData.get('amount'));
      const userData = JSON.parse(currentUser);
      const currentBalance = parseFloat(userData.profits || 0);
      
      if (amount > currentBalance) {
        alert('Insufficient balance');
        return;
      }
      
      userData.profits = (currentBalance - amount).toFixed(2);
      localStorage.setItem('currentUser', JSON.stringify(userData));
      
      alert('Withdrawal request submitted successfully!');
      window.location.href = 'dashboard.html';
    }
    
    function logout() {
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    }
    
    function toggleMobileMenu() {
      const menu = document.querySelector('.navbar-menu');
      menu.classList.toggle('active');
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      feather.replace();
      // Re-render icons after dynamic content
      setTimeout(() => feather.replace(), 100);
    });
  </script>
<script src="page-transitions.js"></script>
</body>
</html>
